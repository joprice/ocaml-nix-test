open Lwt.Syntax

let successes = ref 0

let failures = ref 0

let counter handler request =
  (* not using try%lwt catches exceptions generated by Lwt.fail and raise *)
  try%lwt
    let* result = handler request in
    successes := !successes + 1;
    Lwt.return result
  with exn ->
    failures := !failures + 1;
    raise exn
